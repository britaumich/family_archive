<% if @items.any? %>
  <div class="mb-3 d-flex align-items-center justify-content-between">
    <h4><%= t('views.items.index.items_list') %></h4>
    <%= link_to t('views.items.index.bulk_assign_tags'), editing_tags_page_items_path, class: "btn btn-primary" %>
  </div>
    
    <!-- Items Grid -->
    <div class="row g-4" data-controller="lightbox">
      <% @items.each do |item| %>
        <div class="col-12 col-md-6 col-lg-4 col-xl-3">
          <div class="card h-100 shadow-sm">
          <% if item.file.attached? %>
            <% if item.file.content_type.start_with?('image/') %>
              <a href="<%= url_for(item.file) %>" 
                 data-lightbox="gallery" 
                 data-gallery="items-gallery"
                 data-title="<%= item.caption.present? ? strip_tags(item.caption) : "Item #{item.id}" %>"
                 data-description="Type: <%= item.item_type.humanize %><br>Uploaded: <%= item.created_at.strftime("%B %d, %Y") %>">
                <%= image_tag item.file, 
                    class: "card-img-top lightbox-image", 
                    style: "height: 250px; object-fit: cover;",
                    alt: "Item #{item.id}" %>
              </a>
            <% elsif item.file.content_type.start_with?('video/') %>
              <div class="position-relative">
                <video class="card-img-top lightbox-image" style="height: 250px; object-fit: cover;" muted>
                  <%= content_tag :source, "", src: url_for(item.file), type: item.file.content_type %>
                  Your browser does not support the video tag.
                </video>
                <a href="<%= url_for(item.file) %>" 
                   data-lightbox="gallery" 
                   data-gallery="items-gallery"
                   data-title="<%= item.caption.present? ? strip_tags(item.caption) : "Video #{item.id}" %>"
                   data-description="Type: <%= item.item_type.humanize %><br>Uploaded: <%= item.created_at.strftime("%B %d, %Y") %>"
                   class="stretched-link"></a>
              </div>
            <% else %>
              <%= link_to item_path(item), class: "text-decoration-none" do %>
                <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 250px;">
                  <i class="bi bi-file-text fs-1 text-muted"></i>
                </div>
              <% end %>
            <% end %>
          <% else %>
            <%= link_to item_path(item), class: "text-decoration-none" do %>
              <div class="card-img-top d-flex align-items-center justify-content-center bg-light" style="height: 250px;">
                <i class="bi bi-image fs-1 text-muted"></i>
                <span class="text-muted"><%= t('forms.labels.no_file_attached') %></span>
              </div>
            <% end %>
          <% end %>
          
          <div class="card-body d-flex flex-column">
            <div class="mb-2">
              <small class="text-muted"><%= t('forms.labels.type') %>: <%= item.item_type.humanize %></small>
            </div>
            
            <div class="mb-2">
              <small class="text-muted"><%= t('forms.labels.uploaded') %>: <%= item.created_at.strftime("%B %d, %Y at %I:%M %p") %></small>
            </div>
            
            <!-- Caption -->
            <% if item.caption.present? %>
              <div class="mb-2">
                <p class="mb-0 text-truncate" title="caption">
                  <strong><%= t('forms.labels.caption') %>hell:</strong> <%= strip_tags(item.caption) %>
                </p>
              </div>
            <% end %>
            
            <!-- Tags -->
            <% if item.tags.any? %>
              <div class="mb-2">
                <h6 class="mb-1"><%= t('forms.labels.tags') %>:</h6>
                <div class="d-flex flex-wrap gap-1">
                  <% item.tags.each do |tag| %>
                    <span class="badge bg-secondary"><%= tag.name %></span>
                  <% end %>
                </div>
              </div>
            <% end %>
            
            <div class="mt-auto">
              <%= link_to t('forms.buttons.view_details'), item_path(item), class: "btn btn-primary btn-sm" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="text-center py-5">
    <i class="bi bi-images fs-1 text-muted mb-3"></i>
    <h3 class="text-muted"><%= t('views.items.no_items_yet') %></h3>
    <p class="text-muted"><%= t('views.items.start_building_archive') %></p>
    <%= link_to t('views.items.upload_first_file'), upload_files_page_path, class: "btn btn-um-blue btn-lg" %>
  </div>
<% end %>